<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
    <meta charset="UTF-8">
    <title>Profiles Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Custom Styles -->
    <style>
        .toggle-switch {
            position: absolute;
            top: 15px;
            right: 30px;
        }
            .btn-group .btn {
        font-size: 16px;
        border-radius: 25px; /* Rounded corners */
    }

    .btn-group .btn:hover {
        transform: scale(1.05); /* Slightly increase button size on hover */
        transition: transform 0.3s ease;
    }

    .btn-group .btn i {
        margin-right: 8px; /* Space between icon and text */
    }
    .sidebar {
        height: 100vh; /* Full screen height */
        border-right: 2px solid #dee2e6; /* Border between sidebar and content */
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1); /* Light shadow effect */
    }

    .sidebar-header h4 {
        font-size: 1.25rem;
        font-weight: bold;
        color: #007bff;
    }

    .nav-link {
        font-size: 1rem;
        padding: 10px 15px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .nav-link:hover {
        background-color: #007bff;
    }

    .nav-item i {
        margin-right: 10px; /* Space between icon and text */
    }

    .nav-link.active {
        background-color: #0056b3;
        color: white;
    }

    /* Optional: Add a custom scrollbar if the sidebar content is too long */
    .sidebar {
        overflow-y: auto;
    }
</style>

</head>

<body class="bg-body text-body">
    <div class="d-flex">
        <!-- Sidebar -->
<!-- Sidebar -->
<nav class="sidebar p-3" style="width: 220px;">
    <!-- Sidebar Header -->
    <div class="sidebar-header text-center mb-4">
        <h4 class="text-primary">My Dashboard</h4>
    </div>

    <!-- Sidebar Links -->
    <ul class="nav flex-column">
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="bi bi-house-door"></i> Dashboard
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="bi bi-person"></i> Profiles
            </a>
        </li>
        <!-- Add more links here as needed -->
    </ul>
</nav>


        <!-- Main Content -->
        <div class="flex-fill p-3">
            <div class="container py-5 position-relative">
                <h1 class="text-center mb-4">ðŸ‘¤ Profiles Dashboard</h1>

                <!-- Theme Toggle Switch -->
                <div class="form-check form-switch toggle-switch">
                    <input class="form-check-input" type="checkbox" id="themeToggle">
                    <label class="form-check-label" for="themeToggle">Dark Mode</label>
                </div>

                <!-- Add Profile Form -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <form method="post" class="row g-3">
                            {% csrf_token %}
                            <div class="col-md-5">
                                {{ form.name.label_tag }}
                                {{ form.name }}
                            </div>
                            <div class="col-md-5">
                                {{ form.age.label_tag }}
                                {{ form.age }}
                            </div>
                            <div class="col-md-2 d-grid">
                                <button type="submit" class="btn btn-primary mt-4">Add Profile</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Line Chart -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h4 class="card-title">ðŸ“ˆ Age Line Chart</h4>
                        <canvas id="ageChart" height="120"></canvas>
                    </div>
                </div>

                <!-- Export Buttons -->
<div class="mt-4 text-center">
    <!-- Export Buttons Container -->
    <div class="btn-group" role="group" aria-label="Export Options">
        <!-- Export as Image Button -->
        <button class="btn btn-outline-primary me-3 px-4 py-2" onclick="exportChartAsImage()">
            <i class="bi bi-image"></i> Export as Image
        </button>

        <!-- Export as PDF Button -->
        <button class="btn btn-outline-success me-3 px-4 py-2" onclick="exportChartAsPDF()">
            <i class="bi bi-file-earmark-pdf"></i> Export as PDF
        </button>

        <!-- Export to CSV Button -->
        <a href="{% url 'export_profiles_csv' %}" class="btn btn-outline-secondary px-4 py-2">
            <i class="bi bi-file-earmark-csv"></i> Export to CSV
        </a>
    </div>
</div>


                <!-- View Profiles Button -->
                <div class="text-center">
                    <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#profileModal">
                        View All Profiles
                    </button>
                </div>
            </div>

            <!-- Profiles Modal -->
            <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel"
                aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content shadow">
                        <div class="modal-header">
                            <h5 class="modal-title" id="profileModalLabel">All Profiles</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <input type="text" id="searchInput" class="form-control mb-3"
                                placeholder="Search by name...">
                            <ul class="list-group" id="profileList">
                                {% for profile in page_obj %}
                                <li
                                    class="list-group-item d-flex justify-content-between align-items-center profile-item">
                                    <span class="profile-name">{{ profile.name }}</span> ({{ profile.age }} years)
                                    <button class="btn btn-sm btn-danger"
                                        onclick="confirmDelete({{ profile.id }}, '{{ profile.name }}')">Delete</button>
                                </li>
                                {% endfor %}
                            </ul>

                            <!-- Pagination -->
                            <nav class="mt-3">
                                <ul class="pagination justify-content-center">
                                    {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link"
                                            href="?page={{ page_obj.previous_page_number }}">Previous</a>
                                    </li>
                                    {% endif %}
                                    <li class="page-item disabled">
                                        <span class="page-link">Page {{ page_obj.number }}</span>
                                    </li>
                                    {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script>
        const ctx = document.getElementById('ageChart').getContext('2d');
        const ageChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ names| safe }},
        datasets: [{
            label: 'Age',
            data: {{ ages| safe }},
            borderColor: 'rgba(75, 192, 192, 1)',
            fill: false,
            tension: 0.2,
            pointBackgroundColor: 'rgba(75, 192, 192, 1)',
            pointRadius: 5
                }]
            },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
        });
    </script>

    <!-- Theme Toggle Script -->
    <script>
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;

        // Load theme from localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            htmlElement.setAttribute('data-bs-theme', savedTheme);
            themeToggle.checked = savedTheme === 'dark';
        }

        themeToggle.addEventListener('change', () => {
            const theme = themeToggle.checked ? 'dark' : 'light';
            htmlElement.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
        });
    </script>

    <!-- Search Filter Script -->
    <script>
        const searchInput = document.getElementById('searchInput');
        const profileItems = document.querySelectorAll('.profile-item');

        searchInput.addEventListener('keyup', function () {
            const searchValue = this.value.toLowerCase();
            profileItems.forEach(item => {
                const name = item.querySelector('.profile-name').textContent.toLowerCase();
                item.style.display = name.includes(searchValue) ? '' : 'none';
            });
        });

        function confirmDelete(profileId, profileName) {
            Swal.fire({
                title: `Delete ${profileName}?`,
                text: "This action cannot be undone.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `/delete/${profileId}/`;
                }
            });
        }
    </script>

    <!-- Chart Export Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function exportChartAsImage() {
            const link = document.createElement('a');
            link.download = 'profile_chart.png';
            link.href = document.getElementById('ageChart').toDataURL('image/png');
            link.click();
        }
    const { jsPDF } = window.jspdf;  // Destructure jsPDF
    function exportChartAsPDF() {
        const chartCanvas = document.getElementById('ageChart');
        const chartImage = chartCanvas.toDataURL('image/png');

        const pdf = new jsPDF();
        pdf.text("Profile Age Chart", 10, 10);  // Add text at the top of the PDF
        pdf.addImage(chartImage, 'PNG', 10, 20, 180, 100);  // Add the chart image to the PDF
        pdf.save('profile_chart.pdf');  // Save the PDF file
    }
    </script>

</body>

</html>